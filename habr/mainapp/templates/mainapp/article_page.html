{% extends 'mainapp/base.html' %}
{% load static %}

{% block content %}
    <div class="main_content container">
        <div class="article">
            <div class="post_header">
                <div class="header_habr">
                    <img src={% static "img/files.png" %} alt="">
                    <p class="content_type">Статья</p>
                    <img src={% static "img/divider.png" %} alt="">
                    <a class="content_topic" href="#">{{ article.categories }}</a>
                </div>
                <h1 class="name_habr">
                    <!--                    HR statistics: job search, interviews,-->
                    <!--                    hiring and recruiting-->
                    {{ article.title }}
                </h1>
                <div class="habr_information">
                    <div class="habr_date_creat">
                        <img src={% static "img/Calendar.png" %} alt="">
                        <p class="date">{{ article.created_timestamp|date:"M d, Y" }}</p>
                        <img src={% static 'img/like.png' %} alt="like">
                        <p class="count_like"> {{ article.get_likes_count_by_article_id }} </p>
                    </div>
                    <div class="habr_share">
                        <p>Share:</p>
                        <a href="https://www.instagram.com/" target="_blank">
                            <img src={% static "img/instagram_article.png" %} alt="">
                        </a>
                        <a href="https://www.facebook.com/" target="_blank">
                            <img src={% static "img/facebook_article.png" %} alt="">
                        </a>
                        <a href="https://twitter.com/" target="_blank">
                            <img src={% static "img/twitter_article.png" %} alt="">
                        </a>
                    </div>
                </div>
            </div>
            <div class="image_habr_page">
                <img src="/media/{{ article.main_img }}" alt="">
            </div>
            <div class="text_habr_page">
                <p class="text_bold">
                    {{ article.subtitle }}
                </p>
                <p class="text_normal">

                    {{ article.text |safe }}
                </p>
                <!--            <p class="text_normal">-->
                <!--                               На третьем уроке мы научились передавать в контроллер номер выбранной категории (pk),-->
                <!--                но на контенте страницы это никак не отражалось. Сегодня мы это исправим — но начала немного теории.-->
                <!--                            </p>-->
                <!--                            <p class="text_bold_quote">-->
                <!--                                Тренируемся выполнять запросы в консоли-->
                <!--                            </p>-->
                <!--                            <p class="text_normal">-->
                <!--                                Запустим консоль в корне проекта (python manage.py shell) и выполним код:-->
                <!--                                <br>-->
                <!--                                from mainapp.models import ProductCategory, Product<br>-->
                <!--products = Product.objects.filter(category__pk=1)-->
                <!--                                <br>-->
                <!--                                Если сейчас посмотреть содержимое переменной products, увидим список товаров в категории, значение первичного ключа которой в базе равно 1 <br>-->
                <!--                                Замечание:  <br>-->
                <!--                                Напоминаем, что pk (первичный ключ) и id (идентификатор товара) — это одно и то же в нашем проекте.<br>-->
                <!--                                В ORM выполнение запросов происходит через методы filter(), exclude() и get() менеджера модели. Аргументы методов именованные — это имена атрибутов модели. При обращении к атрибуту связанной модели пишем его через двойное подчеркивание после имени атрибута текущей модели, через который она подключена. Например:<br>-->
                <!--                                <br>-->
                <!--                                <b>category__pk</b> — обращаемся к атрибуту pk связанной модели ProductCategory;<br>-->
                <!--<b>category__name</b> — обращаемся к атрибуту name связанной модели ProductCategory;<br>-->
                <!--<b>category__description</b> — обращаемся к атрибуту description связанной модели ProductCategory.<br>Не забывайте, что в результате работы менеджера модели в большинстве случаев мы получаем объект QuerySet. По сути он является списком, но имеет дополнительные атрибуты и методы (например, атрибут .query, хранящий текст запроса).-->
                <!--                            </p>-->
            </div>
            <div class="tags_and_share">
                <div class="tags_habr">
                    <p>Tags:</p>
                    <a href="#">#дизайн</a>
                    <a href="#">#веб-разработка</a>
                    <a href="#">#маркетинг</a>
                </div>
                <div class="habr_info">
                    <p class="info">Likes :</p>
                    <a class="info_img" href="#"><img src={% static "img/like.png" %} alt=""></a>
                    <p class="info">{{ article.get_likes_count_by_article_id }}</p>
                    <a class="info_img comment" href="#"><img src={% static "img/comment.png" %} alt=""></a>
                    <p class="info comment">{{ article.get_comment_count_by_article_id }}</p>
                </div>
            </div>

            {#            ----- ДОБАВЛЕНИЕ КОММЕНТАРИЯ ----  #}
            {% if user.is_authenticated %}
            <form class="form_add_comment" method="post" enctype="multipart/form-data">
                <input type="text" class="comment_input" placeholder="Напишите свой комментарий">
                <input hidden="true" value="{{ user }}" >
                {% csrf_token %}
                <button type="submit" form="registration-form" class="add_comment_button"> Оставить комментарий</button>
            </form>
            {% endif %}

            {#            ----- КОММЕНТАРИИ ----  #}
            <div class="comment_box">
                {% for comment in article.get_comments_by_article_id %}
                    <div class="comment_views">
                        <div class="comment_attribute">
                            <div class="comment_author">{{ comment.user.username }}</div>
                            <div class="comment_author">{{ comment.created_timestamp }}</div>
                        </div>
                        <div class="comment_text">{{ comment.text }}</div>
                    </div>
                {% endfor %}

            </div>
        </div>

        <div class="sidebar">
            <form>
                <input class="search" type="text" placeholder="Искать здесь...">
                <a class="search_button" href="#"><img src={% static "img/search.png" %} alt=""></a>
            </form>
            <div class="author">
                <h6 class="author_title">автор</h6>
                <div class="avatar_and_info">
                    <div class="avatar">
                        <img src="/media/{{ article.user.get_profile.avatar }}" alt="">
                    </div>

                    <div class="name_and_share">
                        {% if article.user.first_name or article.user.last_name %}
                            <h3>{{ article.user.first_name }} {{ article.user.last_name }}</h3>
                        {% else %}
                            <h3>{{ article.user.get_profile.name }}</h3>
                        {% endif %}
                        <p>
                            {{ article.user.get_profile.bio }}
                        </p>
                        <div class="share_author">
                            <a href="https://www.instagram.com/" target="_blank">
                                <img src={% static "img/instagram_article.png" %} alt="">
                            </a>
                            <a href="https://www.facebook.com/" target="_blank">
                                <img src={% static "img/facebook_article.png" %} alt=""
                                ></a>
                            <a href="https://twitter.com/" target="_blank">
                                <img src={% static "img/twitter_article.png" %} alt="">
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="trending_articles">
                {% if article.get_other_articles_by_author %}
                    <h6 class="trending_articles_title">статьи автора:</h6>
                    {% for other_article in article.get_other_articles_by_author %}
                        <div class="img_and_info_habr">
                            <div class="img_habr">
                                <img src="/media/{{ other_article.main_img }}" alt="article_img">
                            </div>
                            <div class="info_habr">
                                <div class="habr_date_creat">
                                    <img src={% static "img/Calendar.png" %} alt="">
                                    <p class="date">{{ other_article.created_timestamp|date:"M d, Y" }}</p>
                                </div>
                                <a href="{% url 'article' other_article.pk %}">{{ other_article.title }}</a>
                            </div>
                        </div>
                    {% endfor %}
                {% endif %}
            </div>
            <div class="tags_trending">
                <h6 class="trending_articles_title">Tags:</h6>
                <div class="tags">
                    <a href="#">#дизайн</a>
                    <a href="#">#веб-разработка</a>
                    <a href="#">#маркетинг</a>
                    <a href="#">#мобильная разработка</a>
                </div>
            </div>
        </div>
    </div>
{% endblock %}